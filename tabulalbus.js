function Brush(c){var f=this;f.img_uri=c;f.drag_img=new Image;f.drag_img.onload=function(){drag_img_loaded=!0};f.drag_img.src=c;f.stamp=function(c,a){c.save();c.translate(50,50);c.scale(a,a);c.drawImage(f.drag_img,-f.drag_img.width/2,-f.drag_img.height/2);c.restore()}};BrushSizeSlider.prototype=new Slider;function BrushSizeSlider(c,f,h,a,d){Slider.call(this,c+35,f,h,a,void 0,d.userSetSize);addImage(c,f,"./img/Size.png")};function BrushSelector(c,f,h,a,d){var e=this,b=[];e.x=c;e.y=f;e.id=h;var g=function(b){return function(){a.setBrush(d[b])}};(function(d){for(var a=0;a<d.length;a++){var h=c+60*a;b.push(new Button(h,f,e.id+(""+a),g(a),50,50));b[a].addImage(h+7.5,f+7.5,d[a].img_uri,35,35)}})(d)};Surface.prototype=new UIElement;
function Surface(c,f,h,a,d){UIElement.call(this,c,f,d);var e=this;e.w=h;e.h=a;e.init=function(b,g){$("<canvas/>",{id:d}).appendTo("body");$("#"+e.id).attr("height",e.h).attr("width",e.w).css({"border-style":"solid","border-color":"#6e6e6e","border-width":"2px",cursor:"crosshair"});$("#"+e.id).bind("mousedown",e.mousedown);e.setPosition(b,g);e.canv_element=document.getElementById(e.id);e.canvas=e.canv_element.getContext("2d");e.canvas.beginPath();e.canvas.rect(0,0,h,a);e.canvas.fillStyle="white";e.canvas.strokeStyle=
"white";e.canvas.fill();e.canvas.stroke()};e.mousedown=function(b){e.painter.dropBrush(b.pageX-e.canv_element.offsetLeft,b.pageY-e.canv_element.offsetTop,e.canvas);b.originalEvent.preventDefault();$(document).bind("mousemove",e.mousemove);$(document).bind("mouseup",e.mouseup)};e.mousemove=function(b){e.painter.moveBrush(b.pageX-e.canv_element.offsetLeft,b.pageY-e.canv_element.offsetTop,e.canvas)};e.mouseup=function(){$(document).unbind("mousemove");$(document).unbind("mouseup")};e.setPainter=function(b){e.painter=
b};e.save=function(){var b=e.canv_element.toDataURL();open().document.write('<img src="'+b+'"/>')};e.init(c,f)};Painter.prototype=UIElement();
function Painter(c,f,h,a,d,e,b){var g=this,j=0,m=b/100,n=b*e,l,k;UIElement.call(g,c,f,h);g.curcolor=a;g.brush=d;g.setBrush=function(b){g.brush=b;g.updateColor(g.curcolor.color)};g.init=function(b,a){$("<canvas/>",{id:g.id}).appendTo("body");$("#"+g.id).attr("height",100).attr("width",100);$("#"+g.id).css({"border-style":"solid","border-color":"#6e6e6e","border-width":"2px","border-radius":"10px"});g.setPosition(b,a)};g.init(c,f);g.hide=function(){$("#"+g.id).hide()};g.show=function(){$("#"+g.id).show()};
g.updateColor=function(b){g.canvas.clearRect(0,0,100,100);g.brush.stamp(g.canvas,m);Caman("#"+h,function(){this.colorize(b.r,b.g,b.b,100).render()});g.brush.drawing=g.canvas_element};g.canvas_element=document.getElementById(g.id);g.canvas=g.canvas_element.getContext("2d");g.dropBrush=function(b,g){l=b;k=g};g.moveBrush=function(b,a,d){var e,c;c=b-l;var f=a-k;e=Math.sqrt(c*c+f*f);c=Math.atan2(f,c);j+=e;for(j>n&&o(b,a,c,d,g.canvas_element);j>n;)e=l+j*Math.cos(c),f=k+j*Math.sin(c),j-=n,o(e,f,c,d,g.canvas_element);
l=b;k=a};g.setScaling=function(b){m=b/100};g.userSetSize=function(b){m=b;g.updateColor(g.curcolor.color)};var o=function(b,g,a,d,e){d.save();d.globalAlpha=0.3;d.translate(b,g);d.rotate(a);d.drawImage(e,-e.width/2,-e.height/2);d.restore()}};function Color(c,f,h){var a=this;a.h=c;a.s=f;a.v=h;a.callbacks=[];a.broadcastees=[];a.setH=function(d){a.h=d;a.update_color()};a.setS=function(d){a.s=d;a.update_color()};a.setV=function(d){a.v=d;a.update_color()};a.update_color=function(){a.color=a.HSVtoRGB(a.h,a.s,a.v);for(i in a.callbacks)a.callbacks[i](a.color)};a.broadcast=function(){for(i in a.broadcastees)a.broadcastees[i](a.color)};a.HSVtoRGB=function(a,e,b){var g,c,f,h=Math.floor(6*a),l=6*a-h,a=b*(1-e),k=b*(1-l*e),e=b*(1-(1-l)*e);switch(h%
6){case 0:g=b;c=e;f=a;break;case 1:g=k;c=b;f=a;break;case 2:g=a;c=b;f=e;break;case 3:g=a;c=k;f=b;break;case 4:g=e;c=a;f=b;break;case 5:g=b,c=a,f=k}return{r:Math.floor(255*g),g:Math.floor(255*c),b:Math.floor(255*f)}};a.add_callback=function(d){a.callbacks.push(d)};a.add_broadcastee=function(d){a.broadcastees.push(d)};a.color=a.HSVtoRGB(this.h,this.s,this.v)};UIInput.prototype=new UIElement;function UIInput(c,f,h,a){var d=this;UIElement.call(d,c,f,h);d.onclick=a;d.enable=function(){d.enabled=!0;$("#"+d.id).click(d.onclick)};d.addImage=function(a,b,g,c,f){c||f?$("<img/>",{src:g}).appendTo("body").css({top:b,left:a,width:c,height:f}).click(d.onclick):$("<img/>",{src:g}).appendTo("body").css({top:b,left:a}).click(d.onclick)}};function UIElement(c,f,h){var a=this;a.x=c;a.y=f;a.id=h;a.setPosition=function(d,e){a.x=d;a.y=e;$("#"+a.id).css({top:a.y+"px",left:a.x+"px"})};a.addImage=function(a,e,b,g,c){g||c?$("<img/>",{src:b}).appendTo("body").css({top:e,left:a,width:g,height:c}):$("<img/>",{src:b}).appendTo("body").css({top:e,left:a})}};Button.prototype=UIInput();function Button(c,f,h,a,d,e){var b=this;UIInput.call(this,c,f,h,a);b.w=d;b.h=e;b.init=function(a,c){$("<div/>",{"class":"button bordered",id:this.id}).appendTo("body");this.setPosition(a,c);$("#"+b.id).click(b.onclick);(b.w||b.h)&&$("#"+b.id).css({width:b.w,height:b.h})};b.init(c,f)};var OFFSET=6;HSliderButton.prototype=UIInput();
function HSliderButton(c,f,h,a,d,e){var b=this;UIInput.call(b,c,f,a,{});b.x1=c;b.x2=c+h-20;b.range=h;b.down_callback=d||function(){};b.up_callback=e||function(){};b.init=function(a,c){$("<div/>",{"class":"slider_button bordered",id:b.id}).appendTo("body");b.setPosition(a,c);$("#"+b.id).bind("mousedown",b.mouseDown)};b.mouseMove=function(a){a=a.pageX-OFFSET;a>b.x1&&a<b.x2?(b.setPosition(a,b.y),b.down_callback((b.x-b.x1)/b.range)):a<b.x1?(b.setPosition(b.x1,b.y),b.down_callback(0)):a>b.x2&&(b.setPosition(b.x2,
b.y),b.down_callback(1))};b.mouseUp=function(a){$(document).unbind("mouseup");$(document).unbind("mousemove");a=a.pageX-OFFSET;a>b.x1&&a<b.x2?(b.setPosition(a,b.y),b.up_callback((b.x-b.x1)/b.range)):a<b.x1?(b.setPosition(b.x1,b.y),b.up_callback(0)):a>b.x2&&(b.setPosition(b.x2,b.y),b.up_callback(1))};b.mouseDown=function(){$(document).bind("mousemove",b.mouseMove);$(document).bind("mouseup",b.mouseUp)};b.set=function(a){1<a&&(a=1);0>a&&(a=0);b.x=(b.x2-b.x1)*a+b.x1;b.down_callback(a);b.up_callback(a);
b.setPosition(b.x,b.y)};b.init(c,f)}function Slider(c,f,h,a,d,e){var b=this,g=f+OFFSET;$("<div/>",{"class":"slider_bar",id:this.id}).appendTo("body").css({width:h+"px",top:g+"px",left:c+"px"});b.button=new HSliderButton(c,f,h,a+"btn",d,e);b.set=function(a){b.button.set(a)}};ColorPicker.prototype=new UIElement;
function ColorPicker(c,f,h,a){var d=this;UIElement.call(d,c,f,h);d.color=a;d.hueslider=new Slider(c+18,f,150,d.id+"hue",d.color.setH,d.color.broadcast,0);d.satslider=new Slider(c+18,f+35,150,d.id+"sat",d.color.setS,d.color.broadcast,1);d.valslider=new Slider(c+18,f+70,150,d.id+"val",d.color.setV,d.color.broadcast,1);d.addImage(c,f+3,"./img/h.png");d.addImage(c,f+3+35,"./img/s.png");d.addImage(c,f+3+70,"./img/v.png");d.setIndicator=function(a){$("#"+h+"indicator").css({"background-color":"rgb("+a.r+
","+a.g+","+a.b+")"})};$("<div/>",{id:h+"indicator","class":"bordered"}).appendTo("body").css({top:f+105,left:c+18,width:"20",height:"20"});d.set_pos=function(a,b,c){d.hueslider.set(a);d.satslider.set(b);d.valslider.set(c)}};$(document).ready(function(){var c=new Brush("./img/longBrush.png"),f=new Brush("./img/roundBrush.png"),h=new Brush("./img/thinBrush.png"),a=new Brush("./img/messyBrush.png"),f=[c,f,h,a],h=new Color(0,0,0,"color"),a=new ColorPicker(40,460,"cp",h),c=new Painter(240,460,"bview",h,c,0.05,40);h.add_callback(a.setIndicator);h.add_broadcastee(c.updateColor);a.set_pos(0,1,1);h=new Surface(40,40,725,400,"surface");(new BrushSizeSlider(360,535,200,"brSzSl",c)).set(0.5);new BrushSelector(360,460,"brsel",c,
f);f=new Button(660,460,"svbtn",h.save,100,100);f.addImage(675,473,"./img/save.png");f.addImage(625,490,"./img/saveimage.png");h.setPainter(c)});
