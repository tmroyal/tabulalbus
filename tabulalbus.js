function Brush(d){var e=this;e.img_uri=d;e.drag_img=new Image;e.drag_img.onload=function(){drag_img_loaded=!0};e.drag_img.src=d;e.stamp=function(d,b){d.save();d.translate(50,50);d.scale(b,b);d.drawImage(e.drag_img,-e.drag_img.width/2,-e.drag_img.height/2);d.restore()}};BrushSizeSlider.prototype=new Slider;function BrushSizeSlider(d,e,h,b,f){Slider.call(this,d+35,e,h,b,void 0,f.userSetSize);addImage(d,e,"./img/Size.png")};function BrushSelector(d,e,h,b,f){var c=this,a=[];c.x=d;c.y=e;c.id=h;var g=function(a){return function(){b.setBrush(f[a])}};(function(f){for(var b=0;b<f.length;b++){var h=d+60*b;a.push(new Button(h,e,c.id+(""+b),g(b),50,50));a[b].addImage(h+7.5,e+7.5,f[b].img_uri,35,35)}})(f)};Surface.prototype=new UIElement;
function Surface(d,e,h,b,f){UIElement.call(this,d,e,f);var c=this;c.w=h;c.h=b;var a=function(){},g=function(){};c.init=function(a,g){$("<canvas/>",{id:f}).appendTo("body");$("#"+c.id).attr("height",c.h).attr("width",c.w).css({"border-style":"solid","border-color":"#6e6e6e","border-width":"2px",cursor:"crosshair"});$("#"+c.id).bind(m,o);c.setPosition(a,g);c.canv_element=document.getElementById(c.id);c.canvas=c.canv_element.getContext("2d");c.canvas.beginPath();c.canvas.rect(0,0,h,b);c.canvas.fillStyle=
"white";c.canvas.strokeStyle="white";c.canvas.fill();c.canvas.stroke()};var l=function(a){c.painter.dropBrush(a.pageX-c.canv_element.offsetLeft,a.pageY-c.canv_element.offsetTop,c.canvas);a.originalEvent.preventDefault();$(document).bind(j,p);$(document).bind(k,q)},n=function(a){c.painter.moveBrush(a.pageX-c.canv_element.offsetLeft,a.pageY-c.canv_element.offsetTop,c.canvas)},a=function(a){var b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];c.painter.dropBrush(b.pageX-c.canv_element.offsetLeft,
b.pageY-c.canv_element.offsetTop,c.canvas);a.originalEvent.preventDefault();$(document).bind(j,p);$(document).bind(k,q)},g=function(a){var b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],f=b.pageX-c.canv_element.offsetLeft,b=b.pageY-c.canv_element.offsetTop;a.originalEvent.preventDefault();c.painter.moveBrush(f,b,c.canvas)};c.setPainter=function(a){c.painter=a};c.save=function(){var a=c.canv_element.toDataURL();open().document.write('<img src="'+a+'"/>')};var m=null!==document.ontouchstart?
"mousedown":"touchstart",j=null!==document.ontouchmove?"mousemove":"touchmove",k=null!==document.ontouchstart?"mouseup":"touchend",o="mousedown"==m?l:a,p="mousemove"==j?n:g,q=function(){$(document).unbind(j);$(document).unbind(k)};c.init(d,e)};Painter.prototype=UIElement();
function Painter(d,e,h,b,f,c,a){var g=this,l=0,n=a/100,m=a*c,j,k;UIElement.call(g,d,e,h);g.curcolor=b;g.brush=f;g.setBrush=function(a){g.brush=a;g.updateColor(g.curcolor.color)};g.init=function(a,b){$("<canvas/>",{id:g.id}).appendTo("body");$("#"+g.id).attr("height",100).attr("width",100);$("#"+g.id).css({"border-style":"solid","border-color":"#6e6e6e","border-width":"2px","border-radius":"10px"});g.setPosition(a,b)};g.init(d,e);g.hide=function(){$("#"+g.id).hide()};g.show=function(){$("#"+g.id).show()};
g.updateColor=function(a){g.canvas.clearRect(0,0,100,100);g.brush.stamp(g.canvas,n);Caman("#"+h,function(){this.colorize(a.r,a.g,a.b,100).render()});g.brush.drawing=g.canvas_element};g.canvas_element=document.getElementById(g.id);g.canvas=g.canvas_element.getContext("2d");g.dropBrush=function(a,b){j=a;k=b};g.moveBrush=function(a,b,f){var c,d;d=a-j;var e=b-k;c=Math.sqrt(d*d+e*e);d=Math.atan2(e,d);l+=c;for(l>m&&o(a,b,d,f,g.canvas_element);l>m;)c=j+l*Math.cos(d),e=k+l*Math.sin(d),l-=m,o(c,e,d,f,g.canvas_element);
j=a;k=b};g.setScaling=function(a){n=a/100};g.userSetSize=function(a){n=a;g.updateColor(g.curcolor.color)};var o=function(a,b,f,c,g){c.save();c.globalAlpha=0.3;c.translate(a,b);c.rotate(f);c.drawImage(g,-g.width/2,-g.height/2);c.restore()}};function Color(d,e,h){var b=this;b.h=d;b.s=e;b.v=h;b.callbacks=[];b.broadcastees=[];b.setH=function(f){b.h=f;b.update_color()};b.setS=function(f){b.s=f;b.update_color()};b.setV=function(f){b.v=f;b.update_color()};b.update_color=function(){b.color=b.HSVtoRGB(b.h,b.s,b.v);for(i in b.callbacks)b.callbacks[i](b.color)};b.broadcast=function(){for(i in b.broadcastees)b.broadcastees[i](b.color)};b.HSVtoRGB=function(b,c,a){var g,d,e,h=Math.floor(6*b),j=6*b-h,b=a*(1-c),k=a*(1-j*c),c=a*(1-(1-j)*c);switch(h%
6){case 0:g=a;d=c;e=b;break;case 1:g=k;d=a;e=b;break;case 2:g=b;d=a;e=c;break;case 3:g=b;d=k;e=a;break;case 4:g=c;d=b;e=a;break;case 5:g=a,d=b,e=k}return{r:Math.floor(255*g),g:Math.floor(255*d),b:Math.floor(255*e)}};b.add_callback=function(f){b.callbacks.push(f)};b.add_broadcastee=function(f){b.broadcastees.push(f)};b.color=b.HSVtoRGB(this.h,this.s,this.v)};UIInput.prototype=new UIElement;function UIInput(d,e,h,b){var f=this;UIElement.call(f,d,e,h);f.onclick=b;f.enable=function(){f.enabled=!0;$("#"+f.id).click(f.onclick)};f.addImage=function(b,a,d,e,h){e||h?$("<img/>",{src:d}).appendTo("body").css({top:a,left:b,width:e,height:h}).click(f.onclick):$("<img/>",{src:d}).appendTo("body").css({top:a,left:b}).click(f.onclick)}};function UIElement(d,e,h){var b=this;b.x=d;b.y=e;b.id=h;b.setPosition=function(d,c){b.x=d;b.y=c;$("#"+b.id).css({top:b.y+"px",left:b.x+"px"})};b.addImage=function(b,c,a,d,e){d||e?$("<img/>",{src:a}).appendTo("body").css({top:c,left:b,width:d,height:e}):$("<img/>",{src:a}).appendTo("body").css({top:c,left:b})}};Button.prototype=UIInput();function Button(d,e,h,b,f,c){var a=this,g=null!==document.ontouchstart?"click":"touchstart";UIInput.call(this,d,e,h,b);a.w=f;a.h=c;a.init=function(b,c){$("<div/>",{"class":"button bordered",id:this.id}).appendTo("body");this.setPosition(b,c);$("#"+a.id).bind(g,a.onclick);(a.w||a.h)&&$("#"+a.id).css({width:a.w,height:a.h})};a.init(d,e)};var OFFSET=6;HSliderButton.prototype=UIInput();
function HSliderButton(d,e,h,b,f,c){var a=this;UIInput.call(a,d,e,b,{});a.x1=d;a.x2=d+h-20;a.range=h;a.down_callback=f||function(){};a.up_callback=c||function(){};a.init=function(b,c){$("<div/>",{"class":"slider_button bordered",id:a.id}).appendTo("body");a.setPosition(b,c);$("#"+a.id).bind(m,n)};var h=function(a){g(a.pageX-OFFSET)},b=function(a){var b=(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]).pageX-OFFSET;a.originalEvent.preventDefault();g(b)},g=function(b){b>a.x1&&b<a.x2?(a.setPosition(b,
a.y),a.down_callback((a.x-a.x1)/a.range)):b<a.x1?(a.setPosition(a.x1,a.y),a.down_callback(0)):b>a.x2&&(a.setPosition(a.x2,a.y),a.down_callback(1))},f=function(a){l(a.pageX-OFFSET)},c=function(a){var b=(a.originalEvent.touches[0]||a.originalEvent.changedTouches[0]).pageX-OFFSET;a.originalEvent.preventDefault();l(b)},l=function(b){$(document).unbind(k);$(document).unbind(j);b>a.x1&&b<a.x2?(a.setPosition(b,a.y),a.up_callback((a.x-a.x1)/a.range)):b<a.x1?(a.setPosition(a.x1,a.y),a.up_callback(0)):b>a.x2&&
(a.setPosition(a.x2,a.y),a.up_callback(1))},n=function(){$(document).bind(j,o);$(document).bind(k,p)};a.set=function(b){1<b&&(b=1);0>b&&(b=0);a.x=(a.x2-a.x1)*b+a.x1;a.down_callback(b);a.up_callback(b);a.setPosition(a.x,a.y)};var m=null!==document.ontouchstart?"mousedown":"touchstart",j=null!==document.ontouchmove?"mousemove":"touchmove",k=null!==document.ontouchstart?"mouseup":"touchend",o="mousemove"==j?h:b,p="mouseup"==k?f:c;a.init(d,e)}
function Slider(d,e,h,b,f,c){var a=this,g=e+OFFSET;$("<div/>",{"class":"slider_bar",id:this.id}).appendTo("body").css({width:h+"px",top:g+"px",left:d+"px"});a.button=new HSliderButton(d,e,h,b+"btn",f,c);a.set=function(b){a.button.set(b)}};ColorPicker.prototype=new UIElement;
function ColorPicker(d,e,h,b){var f=this;UIElement.call(f,d,e,h);f.color=b;f.hueslider=new Slider(d+18,e,150,f.id+"hue",f.color.setH,f.color.broadcast,0);f.satslider=new Slider(d+18,e+35,150,f.id+"sat",f.color.setS,f.color.broadcast,1);f.valslider=new Slider(d+18,e+70,150,f.id+"val",f.color.setV,f.color.broadcast,1);f.addImage(d,e+3,"./img/h.png");f.addImage(d,e+3+35,"./img/s.png");f.addImage(d,e+3+70,"./img/v.png");f.setIndicator=function(b){$("#"+h+"indicator").css({"background-color":"rgb("+b.r+
","+b.g+","+b.b+")"})};$("<div/>",{id:h+"indicator","class":"bordered"}).appendTo("body").css({top:e+105,left:d+18,width:"20",height:"20"});f.set_pos=function(b,a,d){f.hueslider.set(b);f.satslider.set(a);f.valslider.set(d)}};$(document).ready(function(){var d=new Brush("./img/longBrush.png"),e=new Brush("./img/roundBrush.png"),h=new Brush("./img/thinBrush.png"),b=new Brush("./img/messyBrush.png"),e=[d,e,h,b],h=new Color(0,0,0,"color"),b=new ColorPicker(40,460,"cp",h),d=new Painter(240,460,"bview",h,d,0.05,40);h.add_callback(b.setIndicator);h.add_broadcastee(d.updateColor);b.set_pos(0,1,1);h=new Surface(40,40,725,400,"surface");(new BrushSizeSlider(360,535,200,"brSzSl",d)).set(0.5);new BrushSelector(360,460,"brsel",d,
e);e=new Button(660,460,"svbtn",h.save,100,100);e.addImage(675,473,"./img/save.png");e.addImage(625,490,"./img/saveimage.png");h.setPainter(d)});
